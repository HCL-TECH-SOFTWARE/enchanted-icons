# ======================================================================== #
# Copyright 2025 HCL America Inc.                                          #
# Licensed under the Apache License, Version 2.0 (the "License");          #
# you may not use this file except in compliance with the License.         #
# You may obtain a copy of the License at                                  #
#                                                                          #
# http://www.apache.org/licenses/LICENSE-2.0                               #
#                                                                          #
# Unless required by applicable law or agreed to in writing, software      #
# distributed under the License is distributed on an "AS IS" BASIS,        #
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. #
# See the License for the specific language governing permissions and      #
# limitations under the License.                                           #
# ======================================================================== #
name: Deploy Web Component Icons Preview

on:
  workflow_dispatch:
  push:
    branches:
      - feature/DXQ-43136-enchanted-icons-web-component

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout feature branch
        uses: actions/checkout@v4

      - name: Set up node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: packages/web-component/package-lock.json

      - name: Install dependencies
        run: npm ci
        working-directory: ./packages/web-component

      - name: Build web component package
        run: npm run build-icons-page -- --base=/${{ github.event.repository.name }}/
        working-directory: ./packages/web-component
      
      - name: Deploy built files to gh-pages-wc-icons-preview branch
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: gh-pages-wc-icons-preview
          publish_dir: ./packages/web-component/build
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          force_orphan: true